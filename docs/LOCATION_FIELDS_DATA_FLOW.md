# Location Fields Data Flow Diagram

## Overview

This document illustrates how location data flows from the frontend through the API to Make.com and finally into the generated PDF contract.

---

## Data Flow Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          FRONTEND (React)                                â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  SimpleContractGenerator / SimpleContractGeneratorWithValidation   â”‚ â”‚
â”‚  â”‚                                                                      â”‚ â”‚
â”‚  â”‚  User Input:                                                         â”‚ â”‚
â”‚  â”‚  â€¢ work_location: "Muscat, Oman"                                    â”‚ â”‚
â”‚  â”‚  â€¢ location_en: "Muscat, Oman"              (optional, future)      â”‚ â”‚
â”‚  â”‚  â€¢ location_ar: "Ù…Ø³Ù‚Ø·ØŒ Ø³Ù„Ø·Ù†Ø© Ø¹ÙÙ…Ø§Ù†"         (optional, future)      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚                                     â”‚
â”‚                                     â”‚ POST /api/contracts/makecom/generateâ”‚
â”‚                                     â–¼                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       BACKEND API (Next.js)                              â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  app/api/contracts/makecom/generate/route.ts                       â”‚ â”‚
â”‚  â”‚                                                                      â”‚ â”‚
â”‚  â”‚  Processing:                                                         â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”‚  â”‚ 1. Receive contractData from request                        â”‚   â”‚ â”‚
â”‚  â”‚  â”‚    {                                                         â”‚   â”‚ â”‚
â”‚  â”‚  â”‚      work_location: "Muscat, Oman",                          â”‚   â”‚ â”‚
â”‚  â”‚  â”‚      location_en: "Muscat, Oman",                            â”‚   â”‚ â”‚
â”‚  â”‚  â”‚      location_ar: "Ù…Ø³Ù‚Ø·ØŒ Ø³Ù„Ø·Ù†Ø© Ø¹ÙÙ…Ø§Ù†"                        â”‚   â”‚ â”‚
â”‚  â”‚  â”‚    }                                                         â”‚   â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚  â”‚                                                                      â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”‚  â”‚ 2. Set fallback logic (Lines 173-175)                      â”‚   â”‚ â”‚
â”‚  â”‚  â”‚    const location_en = contractData.location_en ||          â”‚   â”‚ â”‚
â”‚  â”‚  â”‚                        contractData.work_location || '';    â”‚   â”‚ â”‚
â”‚  â”‚  â”‚    const location_ar = contractData.location_ar ||          â”‚   â”‚ â”‚
â”‚  â”‚  â”‚                        contractData.work_location || '';    â”‚   â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚  â”‚                                                                      â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”‚  â”‚ 3. Fetch related data (promoter, parties)                   â”‚   â”‚ â”‚
â”‚  â”‚  â”‚    â€¢ Promoter data with images                              â”‚   â”‚ â”‚
â”‚  â”‚  â”‚    â€¢ First party (employer) data                            â”‚   â”‚ â”‚
â”‚  â”‚  â”‚    â€¢ Second party data                                      â”‚   â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚  â”‚                                                                      â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”‚  â”‚ 4. Enrich contract data (Lines 304-309)                     â”‚   â”‚ â”‚
â”‚  â”‚  â”‚    enrichedContractData = {                                 â”‚   â”‚ â”‚
â”‚  â”‚  â”‚      ...enrichedContractData,                               â”‚   â”‚ â”‚
â”‚  â”‚  â”‚      location_en,                                           â”‚   â”‚ â”‚
â”‚  â”‚  â”‚      location_ar,                                           â”‚   â”‚ â”‚
â”‚  â”‚  â”‚      // + all other fields                                  â”‚   â”‚ â”‚
â”‚  â”‚  â”‚    }                                                         â”‚   â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚  â”‚                                                                      â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”‚  â”‚ 5. Create contract in database                              â”‚   â”‚ â”‚
â”‚  â”‚  â”‚    INSERT INTO contracts (...)                              â”‚   â”‚ â”‚
â”‚  â”‚  â”‚    VALUES (... location_en, location_ar ...)               â”‚   â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚  â”‚                                                                      â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”‚  â”‚ 6. Prepare webhook payload                                  â”‚   â”‚ â”‚
â”‚  â”‚  â”‚    enhancedPayload = {                                      â”‚   â”‚ â”‚
â”‚  â”‚  â”‚      contract_id: "...",                                    â”‚   â”‚ â”‚
â”‚  â”‚  â”‚      contract_number: "PAC-...",                            â”‚   â”‚ â”‚
â”‚  â”‚  â”‚      work_location: "Muscat, Oman",                         â”‚   â”‚ â”‚
â”‚  â”‚  â”‚      location_en: "Muscat, Oman",                           â”‚   â”‚ â”‚
â”‚  â”‚  â”‚      location_ar: "Ù…Ø³Ù‚Ø·ØŒ Ø³Ù„Ø·Ù†Ø© Ø¹ÙÙ…Ø§Ù†",                      â”‚   â”‚ â”‚
â”‚  â”‚  â”‚      promoter_name_en: "...",                               â”‚   â”‚ â”‚
â”‚  â”‚  â”‚      // + all enriched fields                               â”‚   â”‚ â”‚
â”‚  â”‚  â”‚    }                                                         â”‚   â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚                                     â”‚
â”‚                                     â”‚ POST to MAKECOM_WEBHOOK_URL         â”‚
â”‚                                     â–¼                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      MAKE.COM SCENARIO                                   â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Module 1: CustomWebHook (Receive Data)                            â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚  Receives:                                                     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  {                                                             â”‚ â”‚ â”‚
â”‚  â”‚  â”‚    contract_id: "uuid",                                        â”‚ â”‚ â”‚
â”‚  â”‚  â”‚    contract_number: "PAC-22102024-1234",                       â”‚ â”‚ â”‚
â”‚  â”‚  â”‚    work_location: "Muscat, Oman",                              â”‚ â”‚ â”‚
â”‚  â”‚  â”‚    location_en: "Muscat, Oman",                                â”‚ â”‚ â”‚
â”‚  â”‚  â”‚    location_ar: "Ù…Ø³Ù‚Ø·ØŒ Ø³Ù„Ø·Ù†Ø© Ø¹ÙÙ…Ø§Ù†",                           â”‚ â”‚ â”‚
â”‚  â”‚  â”‚    promoter_id: "uuid",                                        â”‚ â”‚ â”‚
â”‚  â”‚  â”‚    first_party_id: "uuid",                                     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚    second_party_id: "uuid",                                    â”‚ â”‚ â”‚
â”‚  â”‚  â”‚    // ... other fields                                         â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  }                                                             â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚                                     â”‚
â”‚                                     â–¼                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Module 53-54: Set contract_id and contract_number variables       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚                                     â”‚
â”‚                                     â–¼                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Module 57-59: Fetch promoter and parties data from Supabase      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚                                     â”‚
â”‚                                     â–¼                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Module 55: SetVariables (Store all data)                          â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚  Variables stored:                                             â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ stored_contract_type                                        â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ stored_promoter_id                                          â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ stored_job_title                                            â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ stored_department                                           â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ stored_work_location                                        â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ stored_location_en â† NEW! âœ¨                                â”‚ â”‚ â”‚
â”‚  â”‚  â”‚    = if(length(1.location_en) > 0;                             â”‚ â”‚ â”‚
â”‚  â”‚  â”‚         1.location_en;                                         â”‚ â”‚ â”‚
â”‚  â”‚  â”‚         1.work_location)                                       â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ stored_location_ar â† NEW! âœ¨                                â”‚ â”‚ â”‚
â”‚  â”‚  â”‚    = if(length(1.location_ar) > 0;                             â”‚ â”‚ â”‚
â”‚  â”‚  â”‚         1.location_ar;                                         â”‚ â”‚ â”‚
â”‚  â”‚  â”‚         1.work_location)                                       â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ stored_basic_salary                                         â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ stored_promoter_name_en                                     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ stored_promoter_name_ar                                     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ stored_promoter_id_card_image_url                           â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ stored_promoter_passport_image_url                          â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ stored_first_party_logo_url                                 â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ ... (26 variables total)                                    â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚                                     â”‚
â”‚                                     â–¼                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Module 4: Get Google Docs template                                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚                                     â”‚
â”‚                                     â–¼                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Module 5: Store template content                                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚                                     â”‚
â”‚                                     â–¼                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Module 56: Create Document from Template                          â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚  Text Replacements:                                            â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ {{ref_number}} â†’ "PAC-22102024-1234"                        â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ {{first_party_name_en}} â†’ "ABC Company"                     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ {{first_party_name_ar}} â†’ "Ø´Ø±ÙƒØ© ABC"                        â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ {{promoter_name_en}} â†’ "John Doe"                           â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ {{promoter_name_ar}} â†’ "Ø¬ÙˆÙ† Ø¯Ùˆ"                             â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ {{location_en}} â†’ "Muscat, Oman" â† NEW! âœ¨                  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚    (from 55.stored_location_en)                                â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ {{location_ar}} â†’ "Ù…Ø³Ù‚Ø·ØŒ Ø³Ù„Ø·Ù†Ø© Ø¹ÙÙ…Ø§Ù†" â† NEW! âœ¨            â”‚ â”‚ â”‚
â”‚  â”‚  â”‚    (from 55.stored_location_ar)                                â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ {{contract_start_date}} â†’ "01-01-2024"                      â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ {{contract_end_date}} â†’ "31-12-2024"                        â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                                                                 â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  Image Replacements:                                           â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ kix.9n0jtkeyw9ii-t.0 â†’ First party logo                     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ kix.2k5omiotmkl-t.0 â†’ Promoter ID card image               â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ kix.4io8vw4k1u1n-t.0 â†’ Promoter passport image             â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                                                                      â”‚ â”‚
â”‚  â”‚  Output: Google Docs document with all fields replaced              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚                                     â”‚
â”‚                                     â–¼                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Module 8: Export Document as PDF                                  â”‚ â”‚
â”‚  â”‚  Output: PDF file with filled contract                             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚                                     â”‚
â”‚                                     â–¼                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Module 9: Upload PDF to Supabase Storage                          â”‚ â”‚
â”‚  â”‚  File: PAC-22102024-1234-John_Doe.pdf                              â”‚ â”‚
â”‚  â”‚  Bucket: contracts                                                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚                                     â”‚
â”‚                                     â–¼                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Module 10: Send webhook back to API                               â”‚ â”‚
â”‚  â”‚  POST /api/webhook/contract-pdf-ready                              â”‚ â”‚
â”‚  â”‚  {                                                                  â”‚ â”‚
â”‚  â”‚    contract_id: "uuid",                                             â”‚ â”‚
â”‚  â”‚    pdf_url: "https://.../contracts/PAC-22102024-1234.pdf",         â”‚ â”‚
â”‚  â”‚    status: "generated"                                              â”‚ â”‚
â”‚  â”‚  }                                                                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚                                     â”‚
â”‚                                     â–¼                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Module 11: Respond to original webhook                            â”‚ â”‚
â”‚  â”‚  Status: 200 OK                                                     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       GENERATED CONTRACT PDF                             â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                      EMPLOYMENT CONTRACT                            â”‚ â”‚
â”‚  â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚ â”‚
â”‚  â”‚                                                                      â”‚ â”‚
â”‚  â”‚  Contract Number: PAC-22102024-1234                                 â”‚ â”‚
â”‚  â”‚                                                                      â”‚ â”‚
â”‚  â”‚  FIRST PARTY (Employer)                                             â”‚ â”‚
â”‚  â”‚  Company Name: ABC Company                                          â”‚ â”‚
â”‚  â”‚                                                                      â”‚ â”‚
â”‚  â”‚  SECOND PARTY (Employee)                                            â”‚ â”‚
â”‚  â”‚  Employee Name: John Doe                                            â”‚ â”‚
â”‚  â”‚  ID Card Number: 12345678                                           â”‚ â”‚
â”‚  â”‚                                                                      â”‚ â”‚
â”‚  â”‚  CONTRACT DETAILS                                                   â”‚ â”‚
â”‚  â”‚  Job Title: Software Engineer                                       â”‚ â”‚
â”‚  â”‚  Department: IT Department                                          â”‚ â”‚
â”‚  â”‚  Work Location: Muscat, Oman  â† âœ¨ FROM location_en                â”‚ â”‚
â”‚  â”‚  Start Date: 01-01-2024                                             â”‚ â”‚
â”‚  â”‚  End Date: 31-12-2024                                               â”‚ â”‚
â”‚  â”‚                                                                      â”‚ â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚ â”‚
â”‚  â”‚                                                                      â”‚ â”‚
â”‚  â”‚                          Ø¹Ù‚Ø¯ Ø¹Ù…Ù„                                    â”‚ â”‚
â”‚  â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚ â”‚
â”‚  â”‚                                                                      â”‚ â”‚
â”‚  â”‚  Ø±Ù‚Ù… Ø§Ù„Ø¹Ù‚Ø¯: PAC-22102024-1234                                       â”‚ â”‚
â”‚  â”‚                                                                      â”‚ â”‚
â”‚  â”‚  Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø£ÙˆÙ„ (ØµØ§Ø­Ø¨ Ø§Ù„Ø¹Ù…Ù„)                                          â”‚ â”‚
â”‚  â”‚  Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ©: Ø´Ø±ÙƒØ© ABC                                               â”‚ â”‚
â”‚  â”‚                                                                      â”‚ â”‚
â”‚  â”‚  Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø«Ø§Ù†ÙŠ (Ø§Ù„Ù…ÙˆØ¸Ù)                                             â”‚ â”‚
â”‚  â”‚  Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù: Ø¬ÙˆÙ† Ø¯Ùˆ                                                 â”‚ â”‚
â”‚  â”‚  Ø±Ù‚Ù… Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù‡ÙˆÙŠØ©: 12345678                                         â”‚ â”‚
â”‚  â”‚                                                                      â”‚ â”‚
â”‚  â”‚  ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù‚Ø¯                                                       â”‚ â”‚
â”‚  â”‚  Ø§Ù„Ù…Ø³Ù…Ù‰ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ: Ù…Ù‡Ù†Ø¯Ø³ Ø¨Ø±Ù…Ø¬ÙŠØ§Øª                                     â”‚ â”‚
â”‚  â”‚  Ø§Ù„Ù‚Ø³Ù…: Ù‚Ø³Ù… ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª                                         â”‚ â”‚
â”‚  â”‚  Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¹Ù…Ù„: Ù…Ø³Ù‚Ø·ØŒ Ø³Ù„Ø·Ù†Ø© Ø¹ÙÙ…Ø§Ù†  â† âœ¨ FROM location_ar             â”‚ â”‚
â”‚  â”‚  ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø¡: 01-01-2024                                            â”‚ â”‚
â”‚  â”‚  ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡: 31-12-2024                                         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Fallback Logic Visualization

### Scenario 1: All Location Fields Provided âœ…

```
Input:
â”œâ”€ work_location: "Muscat, Oman"
â”œâ”€ location_en: "Muscat, Oman"
â””â”€ location_ar: "Ù…Ø³Ù‚Ø·ØŒ Ø³Ù„Ø·Ù†Ø© Ø¹ÙÙ…Ø§Ù†"

Module 55 Processing:
â”œâ”€ stored_location_en = "Muscat, Oman"  (uses location_en)
â””â”€ stored_location_ar = "Ù…Ø³Ù‚Ø·ØŒ Ø³Ù„Ø·Ù†Ø© Ø¹ÙÙ…Ø§Ù†"  (uses location_ar)

Document Output:
â”œâ”€ English section: "Muscat, Oman"  âœ…
â””â”€ Arabic section: "Ù…Ø³Ù‚Ø·ØŒ Ø³Ù„Ø·Ù†Ø© Ø¹ÙÙ…Ø§Ù†"  âœ…
```

### Scenario 2: Only work_location Provided (Backward Compatible) âœ…

```
Input:
â””â”€ work_location: "Muscat, Oman"

Module 55 Processing:
â”œâ”€ stored_location_en = "Muscat, Oman"  (fallback to work_location)
â””â”€ stored_location_ar = "Muscat, Oman"  (fallback to work_location)

Document Output:
â”œâ”€ English section: "Muscat, Oman"  âœ…
â””â”€ Arabic section: "Muscat, Oman"  âœ…
```

### Scenario 3: Partial Location Fields âœ…

```
Input:
â”œâ”€ work_location: "Default Location"
â””â”€ location_en: "Muscat, Oman"

Module 55 Processing:
â”œâ”€ stored_location_en = "Muscat, Oman"  (uses location_en)
â””â”€ stored_location_ar = "Default Location"  (fallback to work_location)

Document Output:
â”œâ”€ English section: "Muscat, Oman"  âœ…
â””â”€ Arabic section: "Default Location"  âœ…
```

### Scenario 4: Empty Location Fields (Edge Case) âš ï¸

```
Input:
â”œâ”€ work_location: ""
â”œâ”€ location_en: ""
â””â”€ location_ar: ""

Module 55 Processing:
â”œâ”€ stored_location_en = ""  (empty)
â””â”€ stored_location_ar = ""  (empty)

Document Output:
â”œâ”€ English section: ""  (blank)
â””â”€ Arabic section: ""  (blank)
```

---

## Key Data Transformation Points

### ðŸ”µ Point 1: API Route (Lines 173-175)

**Purpose:** Set fallback values

```typescript
const location_en =
  contractData.location_en || contractData.work_location || '';
const location_ar =
  contractData.location_ar || contractData.work_location || '';
```

### ðŸ”µ Point 2: API Route (Lines 304-309)

**Purpose:** Add to enriched payload

```typescript
enrichedContractData = {
  ...enrichedContractData,
  location_en,
  location_ar,
};
```

### ðŸ”µ Point 3: Make.com Module 55

**Purpose:** Store with fallback logic

```javascript
{{if(length(1.location_en) > 0; 1.location_en; 1.work_location)}}
```

### ðŸ”µ Point 4: Make.com Module 56

**Purpose:** Replace in template

```json
"location_en": "{{55.stored_location_en}}",
"location_ar": "{{55.stored_location_ar}}"
```

---

## Summary

The location data flows through 4 main stages:

1. **Frontend** â†’ Collects location data (current: work_location only)
2. **API** â†’ Processes and enriches with fallback logic
3. **Make.com** â†’ Stores variables and replaces template placeholders
4. **PDF** â†’ Final document with location in both languages

**Key Feature:** Automatic fallback ensures backward compatibility while supporting future bilingual contracts.

---

## Testing Workflow

```
1. Send test request â†’ /api/contracts/makecom/generate
                       {
                         location_en: "Muscat",
                         location_ar: "Ù…Ø³Ù‚Ø·"
                       }

2. Check logs â†’ API route shows enriched data
                âœ… location_en: "Muscat"
                âœ… location_ar: "Ù…Ø³Ù‚Ø·"

3. Check Make.com â†’ Module 55 shows stored variables
                    âœ… stored_location_en: "Muscat"
                    âœ… stored_location_ar: "Ù…Ø³Ù‚Ø·"

4. Check template â†’ Module 56 replaces placeholders
                    {{location_en}} â†’ "Muscat"
                    {{location_ar}} â†’ "Ù…Ø³Ù‚Ø·"

5. Check PDF â†’ Download and verify
               âœ… English section shows "Muscat"
               âœ… Arabic section shows "Ù…Ø³Ù‚Ø·"
```

---

## Related Documents

- `MAKECOM_LOCATION_UPDATE_STEPS.md` - Step-by-step update guide
- `LOCATION_FIELDS_IMPLEMENTATION.md` - Detailed technical implementation
- `MAKECOM_SIMPLE_CONTRACT_FLOW_WITH_LOCATIONS.json` - Complete Make.com flow
